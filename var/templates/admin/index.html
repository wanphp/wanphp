<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>{{ title }}</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="/datatables/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="/datatables/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css">
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="/js/sweetalert2/sweetalert2.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="/select2/css/select2.min.css">
  <link rel="stylesheet" href="/select2/bootstrap5/select2-bootstrap-5-theme.min.css">
  <!-- Theme style -->
  <link href="/adminlte/css/adminlte.min.css" rel="stylesheet">
</head>

<body class="sidebar-expand-lg sidebar-mini bg-body-tertiary layout-fixed sidebar-open">
<div class="app-wrapper">
  <!-- Navbar -->
  <nav class="app-header navbar navbar-expand bg-body">
    <div class="container-fluid">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" data-lte-toggle="sidebar" href="#" role="button"><i class="fa-solid fa-bars"></i></a></li>
        {% block headnavbar %}
        <li class="nav-item d-none d-md-block">
          <a href="javascript:" data-linkhref="/" class="nav-link">首页</a>
        </li>
        {% if Role<0 %}
        <li class="nav-item d-none d-md-block">
          <a href="javascript:" data-link="/admin/actions" class="nav-link">权限</a>
        </li>
        {% endif %}
        {% endblock %}
      </ul>

      <!-- Right navbar links -->
      <ul class="navbar-nav ms-auto">
        <!-- SEARCH FORM -->
        {% block headnavsearch %}
        <li class="nav-item"><a class="nav-link" data-widget="navbar-search" href="#" role="button"><i class="fas fa-search"></i></a></li>
        {% endblock %}
        <!-- Messages Dropdown Menu -->
        {% block messages %}{% endblock %}
        <!-- Notifications Dropdown Menu -->
        {% block notifications %}{% endblock %}
        <li class="nav-item">
          <a class="nav-link" href="javascript:" id="clearcache"><i class="fas fa-broom"></i> </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/loginOut"><i class="fas fa-sign-out-alt"></i> 退出</a>
        </li>
      </ul>
    </div>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="app-sidebar bg-body-secondary shadow-sm">
    <div class="sidebar-brand">
      <a href="javascript:" class="brand-link">
        <img src="{{ loginUser.headimgurl ?: '/adminlte/img/AdminLTELogo.png' }}" alt="{{loginUser.name}}" class="brand-image rounded-5 shadow">
        <span class="brand-text fw-light">{{loginUser.nickname ?: '系统管理'}}</span>
      </a>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-wrapper">
      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
          {% for index, item in sidebar %}
          <li class="nav-item">
            <a href="#" class="nav-link">
              <i class="nav-icon {{ item.icon }}"></i>
              <p>{{ item.name }}<i class="nav-arrow fas fa-angle-right"></i></p>
            </a>
            {% if item.children %}
            <ul class="nav nav-treeview">
              {% for nav in item.children %}
              <li class="nav-item">
                <a href="javascript:" data-link="{{ nav.route }}" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>{{ nav.name }}</p>
                </a>
              </li>
              {% endfor %}
            </ul>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <main class="app-main">
    <div class="app-content px-0 px-md-1">
      <div class="container-fluid pt-3">
        {% block container %}{% endblock %}
      </div>
    </div>
  </main>

  <footer class="app-footer"><!--begin::To the end-->
    <div class="float-end d-none d-sm-inline"><b>版本</b> 1.0.0</div>
    <strong>Copyright &copy; 2024 {{thisUri}}</strong> 版权所有。
  </footer>
</div>
<!-- ./wrapper -->

<div id="modalDialog" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
    </div>
  </div>
</div>
<!-- jQuery -->
<script src="/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 -->
<script src="/js/sweetalert2/sweetalert2.all.min.js"></script>
<!-- AdminLTE -->
<script src="/adminlte/js/adminlte.min.js"></script>
<!-- DataTables -->
<script src="/datatables/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="/datatables/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
<script src="/datatables/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="/datatables/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>
<script src="/js/dataTable.defaults.js"></script>
<!-- Select2 -->
<script src="/select2/js/select2.full.min.js"></script>
<script src="/select2/js/i18n/zh-CN.js"></script>
<script type="text/javascript">
  const currentUser = {head: '{{loginUser.headimgurl}}', nickname: '{{loginUser.nickname}}', name: '{{loginUser.name}}'};
  const Toast = Swal.mixin({toast: true, position: 'top-end', showConfirmButton: false, timer: 3000});

  function dialog(title, content, callable) {
    Swal.fire({
      title: title,
      text: content,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      confirmButtonText: '确定删除!',
      cancelButtonText: '取消'
    }).then((result) => {
      if (result.isConfirmed) {
        callable();
      }
    });
  }

  function errorDialog(data) {
    if (data.responseJSON) data = data.responseJSON;
    Swal.fire({icon: 'error', title: data.errMsg, confirmButtonText: '好的'}).then((result) => {
      if (result.isConfirmed && data.type === 'reload') location.reload();
    });
  }

  function loadDialog(config) {
    let dialogClass = 'modal-dialog';
    if (config.middle) dialogClass += ' modal-dialog-centered';
    if (config.scrollable) dialogClass += ' modal-dialog-scrollable';
    switch (config.size) {
      case 'sm':
        dialogClass += ' modal-sm';
        break;
      case 'lg':
        dialogClass += ' modal-lg';
        break;
      case 'xl':
        dialogClass += ' modal-xl';
        break;
      case 'fullscreen':
        dialogClass += ' modal-fullscreen';
        break;
    }
    $.ajax({
      url: config.url,
      type: 'GET',
      success: function (body) {
        modalDialog(config.title, body, dialogClass, true);
      },
      error: errorDialog
    });
  }

  function modalDialog(title, body, dialogClass = 'modal-lg', buttons = []|'', callable = null, backdrop = true) {
    let buttonStr = '';
    if (buttons instanceof Array && buttons.length) {
      buttonStr += '<div class="modal-footer">';
      for (const button of buttons) {
        buttonStr += '<button  class="btn btn-' + button.type + '" data-value="' + button.value + '">' + button.text + '</button>';
      }
      buttonStr += '</div>';
    } else if (typeof buttons === 'string') {
      buttonStr = '<div class="modal-footer">' + buttons + '</div>';
    }
    $('#modalDialog').attr('data-bs-backdrop', backdrop).off().on('click', '.modal-footer .btn', function (event) {
      if (callable) {
        callable(event.target.dataset.value);
        $('#modalDialog').modal('hide');
      }
    }).on('hidden.bs.modal', function () {
      $('#modalDialog .modal-body').remove();
      $('#modalDialog .modal-footer').remove();
    });
    $('#modalDialog .modal-title').html(title);
    $('#modalDialog .modal-dialog').attr('class', 'modal-dialog ' + dialogClass);
    $('#modalDialog .modal-dialog .modal-content').append('<div class="modal-body">' + body + '</div>' + buttonStr);
    $('#modalDialog').modal('show');
  }

  function loadAppContent(url) {
    swal.showLoading();
    $('.app-content .container-fluid').load(url + '?loadTpl=1', function (response, status) {
      swal.close();
      if (status === 'error') errorDialog(JSON.parse(response));
      console.log(status);
    });
  }

  if (window.location.hash) loadAppContent(window.location.hash.substring(1));

  window.addEventListener('popstate', function () {
    if (window.location.hash) {
      loadAppContent(window.location.hash.substring(1));
    } else {
      location.href = '/';
    }
  });

  // 怎么随机密码
  function generateRandomString(length) {
    var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
    var result = "";
    for (var i = 0; i < length; i++) {
      result += chars[Math.floor(Math.random() * chars.length)];
    }
    return result;
  }

  $(document).ready(function () {
    $('#clearcache').click(function () {
      $.get('/clearCache', function (data) {
        location.reload();
      });
    });
    $('.sidebar-wrapper li:eq(0)').addClass('menu-open');
    $('.sidebar-wrapper li:eq(0)>a').addClass('active');
    $('.brand-link').click(function () {
      loadDialog({title: '用户信息', url: '/admin/editPassword'});
    });
    $('.nav-item a.nav-link').click(function (e) {
      if (e.currentTarget.dataset.link) {
        window.location.hash = e.currentTarget.dataset.link;
        $('.nav-item li a.active').removeClass('active');
        $(e.currentTarget).parents('ul.nav-treeview').prev().addClass('active');
        $(e.currentTarget).addClass('active');
      }
    });

    $('body').on('submit', 'form.needs-validation', function (e) {
      e.preventDefault();
      e.stopPropagation();
      e.target.classList.add('was-validated');
    }).tooltip({selector: '[data-bs-toggle="tooltip"]'})
      .on('click', '[data-lte-toggle="card-collapse"]', function (event) {
        event.preventDefault();
        (new adminlte.CardWidget(event.target)).toggle();
      });
  });
</script>
<!-- OPTIONAL SCRIPTS -->
{% block scripts %}{% endblock %}
</body>
</html>
